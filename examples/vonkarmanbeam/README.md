This is a preview of the livescript `vonkarmanbeam.mlx`.

# Finding a 2D SSM for a von Kármán beam

This is an example of how to reconstruct a slow 2D SSM of a mechanical system using synthetic measurements of a scalar quantity. In this example, we measure the midpoint displacement of a clamped-clamped von Kármán beam. [1]

![image_0.png
](README_images/image_0.png
)

[1] S. Jain, P. Tiso, and G. Haller, Exact nonlinear model reduction for a von Kármán beam: slow-fast decomposition and spectral submanifolds, *Journal of Sound and Vibration* 423 (2018) 195-211. [https://doi.org/10.1016/j.jsv.2018.01.049](https://doi.org/10.1016/j.jsv.2018.01.049) 

```matlab:Code
clearvars
close all
```

# Example setup

The $N$-degree of freedom dynamical system is of the form

$$
{M\ddot{q} }+{C\dot{q} }+{Kq}+f(q,{\dot{q} })=0
$$

where $f=\mathcal{O}(|q|^2 ,|{\dot{q} }|^2 ,|q||{\dot{q} }|)$ represents the nonlinearities and $M$, $C$, and $K$ are the $n\times n$ mass, stiffness, and damping matrices, respectively.

We rewrite the system in first-order form as

$$
{\dot{x} }=Ax+G(x)=F(x)
$$

with

$x=\left\lbrack \begin{array}{c}
q\\
\dot{q} 
\end{array}\right\rbrack ,~~A=\left\lbrack \begin{array}{cc}
0 & I\\
-M^{-1} K & -M^{-1} C
\end{array}\right\rbrack ,~~G(x)=\left\lbrack \begin{array}{c}
0\\
-M^{-1} f(x)
\end{array}\right\rbrack$.

```matlab:Code
nElements = 12;
[M, C, K, fnl, fExt, outdof, PlotFieldonDefMesh] = buildModel(nElements);
```

```text:Output
Building FE model
```

![figure_0.png
](README_images/figure_0.png
)

```text:Output
Assembling M,C,K matrices
Applying boundary conditions
Solving undamped eigenvalue problem
```

![figure_1.png
](README_images/figure_1.png
)

```text:Output
Assembling external force vector
Getting nonlinearity coefficients
Assembling Tensors
Total time spent on model assembly = 00:00:00
```

```matlab:Code
n = size(M,1);    % mechanical dofs (axial def, transverse def, angle)
[F, lambda] = functionFromTensors(M, C, K, fnl);
```

# Generation of Synthetic Data

Having set up the dynamics of the problem, we now move on to generate synthetic data, which will be used to fit a parametrisation of the manifold. We will divide the data into a training set, for model fitting, and a test set, for validation. In this case we will use one trajectory as the training set and another one as the test set.

```matlab:Code
loads = -[12 14]*1e3;
nTraj = size(loads, 2);
indTest = 1;
indTrain = 2;
```

We now set the initial conditions for the trajectories. Our test set trajectory is initialized by applying a point load at the midpoint of the beam. The load is removed at the start of the simulation. For the training trajectory, we use a different point load magnitude. We expect the trajectories to eventually converge onto a slow 2D manifold, which will be identified and used to reduce the system dynamics.

```matlab:Code
loadvector = loads.*fExt;
IC = getStaticResponse(K, M, F, loadvector, true, PlotFieldonDefMesh);
```

![figure_2.png
](README_images/figure_2.png
)

The data is generated by time-integration of the right-hand side of the system. In this case we are observing the midpoint displacement, so the `observable` function is selected to save only the transverse displacement of the center element. We also make sure that the data is sampled with a sufficiently high frequency.

To save execution time and avoid rerunning the simulation, `newMeasurement` can be set to `false`.

```matlab:Code
newMeasurement = false;
observable = @(x) x(outdof,:);
slowTimeScale = 2*pi/abs(lambda(1));
numberPeriods = 125; numberPointsPerPeriod = 100;
if newMeasurement
    endTime = numberPeriods*slowTimeScale;
    nSamp = numberPeriods*numberPointsPerPeriod+1;
    dt = endTime/(nSamp-1);
    xData = integrateTrajectories(F, endTime, IC, nSamp, observable);
    DataInfo = struct('nElements', nElements, 'loadvector', loadvector);
    save('dataVKDecay.mat', 'DataInfo', 'xData', 'dt', 'endTime', 'nSamp')
else
    load dataVKDecay.mat
    if nElements ~= DataInfo.nElements
       error('The loaded data comes from a model with a different number of elements.') 
    end
end
```

# Delay embedding

Now we arrange the scalar measurements in an observable space of dimension at least $2m+1$, with $m$ the dimension of the manifold. This guarantees that the manifold from the full state space can be embedded in the observable space. The dimensionality of the observable space can be further expanded with the parameter `overEmbed` to facilitate recognition of the manifold from data.

We form a multi-dimensional observable by stacking $d$ subsequent scalar measurements $x$ in a vector $y$, and we will later use the trajectories in this augmented space for the manifold fitting.

$$
\left\lbrack \begin{array}{c}
y_1 \\
\vdots \\
y_{i+1} \\
\vdots \\
y_{d+1} 
\end{array}\right\rbrack =\left\lbrack \begin{array}{c}
x(t^k )\\
\vdots \\
x(t^k +i\Delta t)\\
\vdots \\
x(t^k +d\Delta t)
\end{array}\right\rbrack
$$

The total number of embedded coordinates is $2m+1+{\textrm{overEmbed}}$.

```matlab:Code
SSMDim = 2;
overEmbed = 0;
yData = coordinatesEmbedding(xData, SSMDim, 'OverEmbedding', overEmbed);
```

```text:Output
The 5 embedding coordinates consist of the measured state and its 4 time-delayed measurements.
```

# Data analysis

We need to make sure that the data that we use to identify the slow manifold lies close to it. We can do this by plotting a spectrogram of the beam tip displacement. In general, there may be many vibratory modes present at first, but the faster ones quickly die out.

```matlab:Code
showSpectrogram(yData(indTrain,:), 1);
ylim([0,abs(lambda(1))/2/pi*5])
```

We plot the tip displacement over time for closer inspection. 

```matlab:Code
customFigure();
plot(xData{1,1}, xData{1,2}, xData{2,1}, xData{2,2}, ':');
xlabel('$t \, [$s$]$','Interpreter','latex'); 
ylabel('$u \, [$m$]$','Interpreter','latex'); 
legend({'Trajectory 1', 'Trajectory 2'})
title('Generated data')
```

![figure_3.png
](README_images/figure_3.png
)

Next, we use the information from the spectrogram and plot to remove the first part of the training data. After the first few oscillations have passed, there is one dominant mode left in the frequency spectrum. In this case, faster modes die out very quickly, so we can use almost all of the data. We must however remove the first transient to fulfill the assumption that trajectories lie close to the SSM. We keep only the time interval `sliceInt`.

```matlab:Code
sliceInt = [4*slowTimeScale, endTime];
yDataTrunc = sliceTrajectories(yData, sliceInt);
```

# Datadriven manifold fitting

The measured trajectories are assumed to lie close to a two-dimensional manifold that is tangent at the origin to the eigenspace corresponding to the slowest pair of eigenvalues. We now want to fit a polynomial of order $M$ to the data points to approximate the manifold. Here we use a graph style parametrization, meaning that the manifold is parametrized using coordinates in the computed eigenspace $V_e$. This excludes the possibility of folds on the manifold (however, if necessary we may circumvent this problem by increasing the dimensionality of the observed space). 

![image_1.png
](README_images/image_1.png
)

We seek the $2n\times m_M$ polynomial coefficient matrix $H$ of the manifold on the form

$y=V_e V_e^{\top } y+H\phi_{m,2:M} (V_e^{\top } y)$,

where the function $\phi_{m,2:M} (q)$ computes a vector of all $m_M$ monomials from orders 2 up to $M$ of an $m$-vector $q$. This optimization problem is formulated as the minimization of a cost function computed from the measured data $y_k$,

$$
C_r (V_e ,H)=\sum_{k=1}^N ||y_k -V_e V_e^{\top } y_k -H\phi_{m,2:M} (V_e^{\top } y_k )||
$$

to find $H$ and the $2n\times 2$ eigenspace matrix $V_e$, under the constraints that $V_e^{\top } H=0$ and $V_e^{\top } V_e =I$. The minimization is performed with the Matlab function `fmincon` in `IMGeometry`.

```matlab:Code
SSMOrder = 1;
[IMInfo, SSMChart, SSMFunction] = IMGeometry(yDataTrunc(indTrain,:), SSMDim, SSMOrder);
```

# Plot and validation

Now that we have computed the eigenspace of the manifold, we pass to the reduced coordinates $y$ by projecting all trajectories onto the eigenspace:

$\eta =V_e^{\top } y$.

```matlab:Code
etaData = projectTrajectories(IMInfo, yData);
etaDataTrunc = projectTrajectories(IMInfo, yDataTrunc);
```

We plot the test and training set trajectories projected onto the plane. After all initial transients die out, the trajectories seem to be confined to a slowly decaying oscillating eigenmode. This is the data we will use to train our reduced order model for the dynamics. In these coordinates, the initial transient that we removed is visible as irregular high-frequency oscillations in the first revolution.

```matlab:Code
plotReducedCoordinates(etaData);
legend({'Test set trajectory', 'Training set trajectory'})
```

![figure_4.png
](README_images/figure_4.png
)

Furthermore, we draw the end tip component of the manifold shape along with the truncated trajectory from the training set. 

```matlab:Code
plotSSMWithTrajectories(IMInfo, 1, yDataTrunc(indTrain,:))
view(-100,20); zlabel('$u \, [$m$]$','Interpreter','latex')
```

![figure_5.png
](README_images/figure_5.png
)

# Reduced order model

We compute a model for the reduced dynamics with the truncated training data projected onto the manifold. The function `IMDynamicsFlow` fits a polynomial map

$$
\dot{\eta} =W_r \phi (\eta )
$$

where $\phi (\eta )$ again computes a vector of all monomials of $\eta$, and  $W_r$ is a matrix of polynomial coefficients. 

We are also specifying that we want the reduced dynamics on a normal form, and seek the Taylor expansion of a map $N$ fulfilling

$$
\dot{z} =N(z)=Dz+W_n \phi (z)
$$

with $D$ a diagonal matrix and $W_n$ containing coefficients for the near-resonant nonlinear terms, after a near-identity change of coordinates

$$
z=T^{-1} (\eta )=\eta +W_t \phi (\eta )
$$

with $W_t$ containing the coefficients for the nonlinear terms of the coordinate change.

```matlab:Code
ROMOrder = 7;
RDInfo = IMDynamicsFlow(etaDataTrunc(indTrain,:), ...
    'R_PolyOrd', ROMOrder, 'style', 'normalform');
```

```text:Output
Estimation of the reduced dynamics...  Done. 
Estimation of the reduced dynamics in normal form...
                                                        First-order 
 Iteration  Func-count       f(x)        Step-size       optimality
     0           1          879.584                      2.03e+03
     1           2          269.471    0.000491843       3.46e+03  
     2           4          102.793       0.277922            611  
     3           5          17.7056              1            255  
     4           6          6.88123              1           40.9  
     5           7          6.41221              1           53.8  
     6           9          6.14447       0.409598           49.8  
     7          10          5.58621              1           18.6  
     8          11          5.34047              1           19.3  
     9          12          5.10719              1           21.2  
    10          13          4.82521              1           15.1  
    11          14          4.67595              1             10  
    12          15          4.61758              1           9.51  
    13          16          4.58196              1           7.65  
    14          17          4.53508              1           6.98  
    15          18          4.49229              1           5.55  
    16          19          4.46925              1              3  
    17          20          4.46132              1           2.62  
    ... 
   570         573         0.120461              1          0.134  
   571         574          0.12039              1         0.0795  
   572         575         0.120367              1         0.0202  
   573         576         0.120365              1        0.00104  
   574         577         0.120365              1       0.000186  
   575         578         0.120365              1       1.76e-05  
   576         579         0.120365              1       4.83e-06  
   577         580         0.120365              1       4.83e-06  

Local minimum possible.

fminunc stopped because the size of the current step is less than
the value of the step size tolerance.

<stopping criteria details>
Plotting figure with the polar normal form equations ... Done. 
```

![figure_6.png
](README_images/figure_6.png
)

We transform the truncated initial condition of our test trajectory according to the obtained change of coordinates, and integrate our reduced order evolution rule to predict the development of the trajectory. 

```matlab:Code
[yRec, etaRec, zRec] = advect(IMInfo, RDInfo, yDataTrunc);
```

# Evaluation of reduced dynamics

The normalized mean trajectory error NMTE is computed as the average distance of the predicted trajectory to the measured one in the observable space, normalized by the observable vector with maximum norm in the data. 

```matlab:Code
normedTrajDist = computeTrajectoryErrors(yRec, yDataTrunc);
NMTE = mean(normedTrajDist(indTest))
```

```text:Output
NMTE = 0.0255
```

We plot the true test set trajectory in the reduced coordinates and compare it to the prediction. 

```matlab:Code
plotReducedCoordinates(etaDataTrunc(indTest,:), etaRec(indTest,:))
legend({'Test set (truncated)', 'Prediction'})
```

![figure_7.png
](README_images/figure_7.png
)

We also plot the measured and predicted tip displacement. The reduced model seems to do well on previously unseen data, provided that it is close to the 2D manifold.

```matlab:Code
plotTrajectories(yData(indTest,:), yRec(indTest,:), 'm', 'DisplayName', {'Test set', 'Prediction'})
ylabel('$u \, [$m$]$','Interpreter','latex')
```

We compare the estimated eigenvalues of the continuous evolution function to the ones computed from the linearized system. 

```matlab:Code
lambda = sort(lambda);
DSEigenvalues = lambda(1:SSMDim)
```

```text:Output
DSEigenvalues = 2x1 complex    
1.0e+02 *

  -0.0309 - 6.5772i
  -0.0309 + 6.5772i

```

```matlab:Code
reconstructedEigenvalues = sort(RDInfo.eigenvaluesLinPartFlow)
```

```text:Output
reconstructedEigenvalues = 2x1 complex    
1.0e+02 *

  -0.0304 - 6.5774i
  -0.0304 + 6.5774i

```

# Backbone curves

With the knowledge of the coefficients of the normal form, we extract backbone curves for the instantaneous damping and frequency. In this delay-embedding example, the reference physical amplitude is that of the first coordinate.

```matlab:Code
zData = transformTrajectories(RDInfo.inverseTransformation.map, etaData);
rhoCal = abs(zData{indTest(1),2}(1,1));
amplitudeFunction = @(x) x(1,:);
figure
BBCInfo = backboneCurves(IMInfo, RDInfo, amplitudeFunction, rhoCal);
subplot(121); ylabel('$u \, [$m$]$','Interpreter','latex')
subplot(122); ylabel('$u \, [$m$]$','Interpreter','latex')
```

# Forced response curves

The data-driven model trained on autonomous data can now be used for forced response predictions. With the addition of forcing, the normal form dynamics becomes 

$\dot{z} =N(z)+f_{red} e^{i\Omega t}$,

where $\Omega$ is the forcing frequency and $f_{red}$ is the forcing amplitude. For FRC extraction, we analytically compute fixed points of the polar normal form via a closed form solution. Our results are compared to those of SSMTool and of direct numerical integrations.

## SSMTool

We first compute the forced response using the full model with SSMTool. We will later compare this result with that obtained from our data-driven reduced order model. 

```matlab:Code
fFull = [15 45 95]; % forcing levels in the full state space
omegaSpan = abs(imag(lambda(1)))*[0.9 1.3];
FRCSSMTool = SSMToolFRCcustom(M, C, K, fnl, fExt, fFull, outdof, omegaSpan, ROMOrder,2e3); % to pick up some hard continuation points
```

```text:Output
Due to high-dimensionality, we compute only the first 5 eigenvalues with the smallest magnitude. These would also be used to compute the spectral quotients
Assuming a proportional damping hypthesis with symmetric matrices
modal damping ratio for 1 mode is 4.698027e-03
modal damping ratio for 2 mode is 1.295171e-02
modal damping ratio for 3 mode is 2.539951e-02
modal damping ratio for 4 mode is 4.202081e-02
modal damping ratio for 5 mode is 6.286832e-02

 The first 10 nonzero eigenvalues are given as 
   1.0e+03 *

  -0.0031 + 0.6577i
  -0.0031 - 0.6577i
  -0.0235 + 1.8131i
  -0.0235 - 1.8131i
  -0.0903 + 3.5548i
  -0.0903 - 3.5548i
  -0.2472 + 5.8777i
  -0.2472 - 5.8777i
  -0.5533 + 8.7842i
  -0.5533 - 8.7842i

*****************************************
Calculating FRC using SSM with master subspace: [1  2]
(near) outer resonance detected for the following combination of master eigenvalues
     2     0
     3     0
     3     1
     4     1
     4     2
     5     2
     5     3
     6     3
     6     4
     0     2
     0     3
     1     3
     1     4
     2     4
     2     5
     3     5
     3     6
     4     6
     5     0
     6     0
     6     1
     7     1
     7     2
     8     2
     0     5
     0     6
     1     6
     1     7
     2     7
     2     8
     8     0
     9     0
     9     1
     0     8
     0     9
     1     9

These are in resonance with the follwing eigenvalues of the slave subspace
   1.0e+03 *

  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.2472 + 5.8777i
  -0.2472 + 5.8777i
  -0.2472 + 5.8777i
  -0.2472 - 5.8777i
  -0.2472 - 5.8777i
  -0.2472 - 5.8777i

sigma_out = 179
(near) inner resonance detected for the following combination of master eigenvalues
     2     1
     3     2
     4     3
     5     4
     1     2
     2     3
     3     4
     4     5

These are in resonance with the follwing eigenvalues of the master subspace
   1.0e+02 *

  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i

sigma_in = 179
Due to (near) outer resonance, the exisitence of the manifold is questionable and the underlying computation may suffer.
Attempting manifold computation
Manifold computation time at order 2 = 00:00:00
Estimated memory usage at order  2 = 7.52E-02 MB
Manifold computation time at order 3 = 00:00:00
Estimated memory usage at order  3 = 1.01E-01 MB
Manifold computation time at order 4 = 00:00:00
Estimated memory usage at order  4 = 1.29E-01 MB
Manifold computation time at order 5 = 00:00:00
Estimated memory usage at order  5 = 1.76E-01 MB
Manifold computation time at order 6 = 00:00:00
Estimated memory usage at order  6 = 2.29E-01 MB
Manifold computation time at order 7 = 00:00:00
Estimated memory usage at order  7 = 3.08E-01 MB

 Run='freqSubint1.ep': Continue equilibria along primary branch.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          5.37e-05  9.30e+02    0.0    0.0    0.0
   1   1  1.00e+00  2.43e-04  7.86e-08  9.30e+02    0.0    0.0    0.0
   2   1  1.00e+00  6.24e-09  1.73e-18  9.30e+02    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE            om         rho1          th1          eps
    0  00:00:00   9.3016e+02      1  EP      6.5772e+02   1.2996e-03   2.3226e+00   1.0000e+00
   10  00:00:00   9.2602e+02      2          6.5479e+02   9.9151e-04   2.5511e+00   1.0000e+00
   20  00:00:00   9.2103e+02      3          6.5126e+02   6.9584e-04   2.7405e+00   1.0000e+00
   30  00:00:00   9.1603e+02      4          6.4773e+02   5.0646e-04   2.8535e+00   1.0000e+00
   40  00:00:00   9.1103e+02      5          6.4419e+02   3.9001e-04   2.9211e+00   1.0000e+00
   50  00:00:00   9.0603e+02      6          6.4066e+02   3.1479e-04   2.9641e+00   1.0000e+00
   60  00:00:00   9.0104e+02      7          6.3712e+02   2.6311e-04   2.9935e+00   1.0000e+00
   70  00:00:00   8.9604e+02      8          6.3359e+02   2.2571e-04   3.0147e+00   1.0000e+00
   80  00:00:00   8.9104e+02      9          6.3005e+02   1.9748e-04   3.0306e+00   1.0000e+00
   90  00:00:00   8.8604e+02     10          6.2651e+02   1.7546e-04   3.0430e+00   1.0000e+00
  100  00:00:00   8.8104e+02     11          6.2298e+02   1.5782e-04   3.0530e+00   1.0000e+00
  110  00:00:00   8.7604e+02     12          6.1944e+02   1.4339e-04   3.0611e+00   1.0000e+00
  120  00:00:00   8.7104e+02     13          6.1591e+02   1.3136e-04   3.0679e+00   1.0000e+00
  130  00:00:01   8.6604e+02     14          6.1237e+02   1.2118e-04   3.0736e+00   1.0000e+00
  140  00:00:01   8.6104e+02     15          6.0884e+02   1.1247e-04   3.0785e+00   1.0000e+00
  150  00:00:01   8.5604e+02     16          6.0530e+02   1.0492e-04   3.0827e+00   1.0000e+00
  160  00:00:01   8.5104e+02     17          6.0177e+02   9.8314e-05   3.0864e+00   1.0000e+00
  170  00:00:01   8.4604e+02     18          5.9823e+02   9.2492e-05   3.0897e+00   1.0000e+00
  180  00:00:01   8.4104e+02     19          5.9469e+02   8.7319e-05   3.0926e+00   1.0000e+00
  188  00:00:01   8.3715e+02     20  EP      5.9194e+02   8.3679e-05   3.0947e+00   1.0000e+00

 STEP      TIME        ||U||  LABEL  TYPE            om         rho1          th1          eps
    0  00:00:01   9.3016e+02     21  EP      6.5772e+02   1.2996e-03   2.3226e+00   1.0000e+00
   10  00:00:01   9.3428e+02     22          6.6064e+02   1.6041e-03   2.0154e+00   1.0000e+00
   20  00:00:01   9.3836e+02     23          6.6352e+02   1.7374e-03   1.3626e+00   1.0000e+00
   30  00:00:01   9.3848e+02     24  FP      6.6360e+02   1.6561e-03   1.2007e+00   1.0000e+00
   30  00:00:01   9.3848e+02     25  SN      6.6360e+02   1.6561e-03   1.2007e+00   1.0000e+00
   30  00:00:01   9.3848e+02     26          6.6360e+02   1.6472e-03   1.1869e+00   1.0000e+00
   40  00:00:01   9.3833e+02     27  FP      6.6350e+02   1.3622e-03   8.7235e-01   1.0000e+00
   40  00:00:02   9.3833e+02     28  SN      6.6350e+02   1.3622e-03   8.7235e-01   1.0000e+00
   40  00:00:02   9.3833e+02     29          6.6350e+02   1.3499e-03   8.6161e-01   1.0000e+00
   50  00:00:02   9.3841e+02     30          6.6356e+02   1.2241e-03   7.5850e-01   1.0000e+00
   60  00:00:02   9.3972e+02     31          6.6448e+02   8.8236e-04   5.1819e-01   1.0000e+00
   70  00:00:02   9.4471e+02     32          6.6801e+02   5.3640e-04   3.0563e-01   1.0000e+00
   80  00:00:02   9.4971e+02     33          6.7154e+02   3.9631e-04   2.2414e-01   1.0000e+00
   90  00:00:02   9.5471e+02     34          6.7508e+02   3.1549e-04   1.7786e-01   1.0000e+00
  100  00:00:02   9.5971e+02     35          6.7862e+02   2.6231e-04   1.4763e-01   1.0000e+00
  110  00:00:02   9.6471e+02     36          6.8215e+02   2.2454e-04   1.2625e-01   1.0000e+00
  120  00:00:02   9.6971e+02     37          6.8569e+02   1.9630e-04   1.1030e-01   1.0000e+00
  130  00:00:02   9.7471e+02     38          6.8922e+02   1.7437e-04   9.7932e-02   1.0000e+00
  140  00:00:02   9.7971e+02     39          6.9276e+02   1.5685e-04   8.8064e-02   1.0000e+00
  150  00:00:02   9.8471e+02     40          6.9629e+02   1.4253e-04   8.0005e-02   1.0000e+00
  160  00:00:03   9.8971e+02     41          6.9983e+02   1.3060e-04   7.3297e-02   1.0000e+00
  170  00:00:03   9.9471e+02     42          7.0336e+02   1.2052e-04   6.7628e-02   1.0000e+00
  180  00:00:03   9.9971e+02     43          7.0690e+02   1.1188e-04   6.2773e-02   1.0000e+00
  190  00:00:03   1.0047e+03     44          7.1044e+02   1.0439e-04   5.8568e-02   1.0000e+00
  200  00:00:03   1.0097e+03     45          7.1397e+02   9.7844e-05   5.4891e-02   1.0000e+00
  210  00:00:03   1.0147e+03     46          7.1751e+02   9.2069e-05   5.1648e-02   1.0000e+00
  220  00:00:03   1.0197e+03     47          7.2104e+02   8.6938e-05   4.8768e-02   1.0000e+00
  230  00:00:03   1.0247e+03     48          7.2458e+02   8.2349e-05   4.6191e-02   1.0000e+00
  240  00:00:03   1.0297e+03     49          7.2811e+02   7.8219e-05   4.3873e-02   1.0000e+00
  250  00:00:03   1.0347e+03     50          7.3165e+02   7.4484e-05   4.1777e-02   1.0000e+00
  260  00:00:03   1.0397e+03     51          7.3518e+02   7.1089e-05   3.9871e-02   1.0000e+00
  270  00:00:03   1.0447e+03     52          7.3872e+02   6.7989e-05   3.8132e-02   1.0000e+00
  280  00:00:04   1.0497e+03     53          7.4225e+02   6.5149e-05   3.6539e-02   1.0000e+00
  290  00:00:04   1.0547e+03     54          7.4579e+02   6.2537e-05   3.5073e-02   1.0000e+00
  300  00:00:04   1.0597e+03     55          7.4933e+02   6.0125e-05   3.3720e-02   1.0000e+00
  310  00:00:04   1.0647e+03     56          7.5286e+02   5.7893e-05   3.2467e-02   1.0000e+00
  320  00:00:04   1.0697e+03     57          7.5640e+02   5.5821e-05   3.1305e-02   1.0000e+00
  330  00:00:04   1.0747e+03     58          7.5993e+02   5.3891e-05   3.0222e-02   1.0000e+00
  340  00:00:04   1.0797e+03     59          7.6347e+02   5.2091e-05   2.9213e-02   1.0000e+00
  350  00:00:04   1.0847e+03     60          7.6700e+02   5.0407e-05   2.8268e-02   1.0000e+00
  360  00:00:04   1.0897e+03     61          7.7054e+02   4.8828e-05   2.7382e-02   1.0000e+00
  370  00:00:04   1.0947e+03     62          7.7407e+02   4.7346e-05   2.6551e-02   1.0000e+00
  380  00:00:04   1.0997e+03     63          7.7761e+02   4.5950e-05   2.5768e-02   1.0000e+00
  390  00:00:04   1.1047e+03     64          7.8115e+02   4.4635e-05   2.5030e-02   1.0000e+00
  400  00:00:04   1.1097e+03     65          7.8468e+02   4.3392e-05   2.4333e-02   1.0000e+00
  410  00:00:05   1.1147e+03     66          7.8822e+02   4.2217e-05   2.3674e-02   1.0000e+00
  420  00:00:05   1.1197e+03     67          7.9175e+02   4.1104e-05   2.3050e-02   1.0000e+00
  430  00:00:05   1.1247e+03     68          7.9529e+02   4.0049e-05   2.2458e-02   1.0000e+00
  440  00:00:05   1.1297e+03     69          7.9882e+02   3.9046e-05   2.1895e-02   1.0000e+00
  450  00:00:05   1.1347e+03     70          8.0236e+02   3.8091e-05   2.1360e-02   1.0000e+00
  460  00:00:05   1.1397e+03     71          8.0589e+02   3.7183e-05   2.0851e-02   1.0000e+00
  470  00:00:05   1.1447e+03     72          8.0943e+02   3.6317e-05   2.0365e-02   1.0000e+00
  480  00:00:05   1.1497e+03     73          8.1297e+02   3.5490e-05   1.9901e-02   1.0000e+00
  490  00:00:05   1.1547e+03     74          8.1650e+02   3.4700e-05   1.9458e-02   1.0000e+00
  500  00:00:05   1.1597e+03     75          8.2004e+02   3.3945e-05   1.9034e-02   1.0000e+00
  510  00:00:05   1.1647e+03     76          8.2357e+02   3.3221e-05   1.8629e-02   1.0000e+00
  520  00:00:06   1.1697e+03     77          8.2711e+02   3.2528e-05   1.8240e-02   1.0000e+00
  530  00:00:06   1.1747e+03     78          8.3064e+02   3.1863e-05   1.7867e-02   1.0000e+00
  540  00:00:06   1.1797e+03     79          8.3418e+02   3.1225e-05   1.7509e-02   1.0000e+00
  550  00:00:06   1.1847e+03     80          8.3771e+02   3.0612e-05   1.7165e-02   1.0000e+00
  560  00:00:06   1.1897e+03     81          8.4125e+02   3.0022e-05   1.6835e-02   1.0000e+00
  570  00:00:06   1.1947e+03     82          8.4479e+02   2.9455e-05   1.6517e-02   1.0000e+00
  580  00:00:06   1.1997e+03     83          8.4832e+02   2.8909e-05   1.6210e-02   1.0000e+00
  590  00:00:06   1.2047e+03     84          8.5186e+02   2.8382e-05   1.5915e-02   1.0000e+00
  599  00:00:06   1.2092e+03     85  EP      8.5503e+02   2.7926e-05   1.5659e-02   1.0000e+00
```

![figure_8.png
](README_images/figure_8.png
)

```text:Output
Total time spent on FRC computation upto O(7) = 00:00:09
*****************************************
Calculating FRC using SSM with master subspace: [1  2]
(near) outer resonance detected for the following combination of master eigenvalues
     2     0
     3     0
     3     1
     4     1
     4     2
     5     2
     5     3
     6     3
     6     4
     0     2
     0     3
     1     3
     1     4
     2     4
     2     5
     3     5
     3     6
     4     6
     5     0
     6     0
     6     1
     7     1
     7     2
     8     2
     0     5
     0     6
     1     6
     1     7
     2     7
     2     8
     8     0
     9     0
     9     1
     0     8
     0     9
     1     9

These are in resonance with the follwing eigenvalues of the slave subspace
   1.0e+03 *

  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.2472 + 5.8777i
  -0.2472 + 5.8777i
  -0.2472 + 5.8777i
  -0.2472 - 5.8777i
  -0.2472 - 5.8777i
  -0.2472 - 5.8777i

sigma_out = 179
(near) inner resonance detected for the following combination of master eigenvalues
     2     1
     3     2
     4     3
     5     4
     1     2
     2     3
     3     4
     4     5

These are in resonance with the follwing eigenvalues of the master subspace
   1.0e+02 *

  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i

sigma_in = 179
Due to (near) outer resonance, the exisitence of the manifold is questionable and the underlying computation may suffer.
Attempting manifold computation
Manifold computation time at order 2 = 00:00:00
Estimated memory usage at order  2 = 7.52E-02 MB
Manifold computation time at order 3 = 00:00:00
Estimated memory usage at order  3 = 1.01E-01 MB
Manifold computation time at order 4 = 00:00:00
Estimated memory usage at order  4 = 1.29E-01 MB
Manifold computation time at order 5 = 00:00:00
Estimated memory usage at order  5 = 1.76E-01 MB
Manifold computation time at order 6 = 00:00:00
Estimated memory usage at order  6 = 2.29E-01 MB
Manifold computation time at order 7 = 00:00:00
Estimated memory usage at order  7 = 3.08E-01 MB

 Run='freqSubint1.ep': Continue equilibria along primary branch.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          3.87e-01  9.30e+02    0.0    0.0    0.0
   1   1  1.00e+00  8.15e-02  1.06e-02  9.30e+02    0.0    0.0    0.0
   2   1  1.00e+00  5.75e-04  1.11e-06  9.30e+02    0.0    0.0    0.0
   3   1  1.00e+00  2.05e-08  8.88e-16  9.30e+02    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE            om         rho1          th1          eps
    0  00:00:00   9.3016e+02      1  EP      6.5772e+02   2.0778e-03   2.7401e+00   1.0000e+00
   10  00:00:00   9.2601e+02      2          6.5478e+02   1.8165e-03   2.7935e+00   1.0000e+00
   20  00:00:00   9.2101e+02      3          6.5125e+02   1.5203e-03   2.8525e+00   1.0000e+00
   30  00:00:00   9.1601e+02      4          6.4771e+02   1.2615e-03   2.9030e+00   1.0000e+00
   40  00:00:00   9.1101e+02      5          6.4418e+02   1.0501e-03   2.9437e+00   1.0000e+00
   50  00:00:00   9.0601e+02      6          6.4064e+02   8.8496e-04   2.9752e+00   1.0000e+00
   60  00:00:00   9.0101e+02      7          6.3711e+02   7.5767e-04   2.9994e+00   1.0000e+00
   70  00:00:00   8.9601e+02      8          6.3357e+02   6.5902e-04   3.0180e+00   1.0000e+00
   80  00:00:00   8.9101e+02      9          6.3003e+02   5.8144e-04   3.0327e+00   1.0000e+00
   90  00:00:00   8.8601e+02     10          6.2650e+02   5.1935e-04   3.0443e+00   1.0000e+00
  100  00:00:00   8.8101e+02     11          6.2296e+02   4.6877e-04   3.0538e+00   1.0000e+00
  110  00:00:00   8.7601e+02     12          6.1943e+02   4.2690e-04   3.0617e+00   1.0000e+00
  120  00:00:00   8.7101e+02     13          6.1589e+02   3.9174e-04   3.0683e+00   1.0000e+00
  130  00:00:01   8.6601e+02     14          6.1236e+02   3.6184e-04   3.0739e+00   1.0000e+00
  140  00:00:01   8.6101e+02     15          6.0882e+02   3.3611e-04   3.0787e+00   1.0000e+00
  150  00:00:01   8.5602e+02     16          6.0529e+02   3.1376e-04   3.0829e+00   1.0000e+00
  160  00:00:01   8.5102e+02     17          6.0175e+02   2.9417e-04   3.0866e+00   1.0000e+00
  170  00:00:01   8.4602e+02     18          5.9821e+02   2.7686e-04   3.0898e+00   1.0000e+00
  180  00:00:01   8.4102e+02     19          5.9468e+02   2.6146e-04   3.0927e+00   1.0000e+00
  188  00:00:01   8.3715e+02     20  EP      5.9194e+02   2.5067e-04   3.0947e+00   1.0000e+00

 STEP      TIME        ||U||  LABEL  TYPE            om         rho1          th1          eps
    0  00:00:01   9.3016e+02     21  EP      6.5772e+02   2.0778e-03   2.7401e+00   1.0000e+00
   10  00:00:01   9.3431e+02     22          6.6065e+02   2.3426e-03   2.6845e+00   1.0000e+00
   20  00:00:01   9.3931e+02     23          6.6419e+02   2.6573e-03   2.6160e+00   1.0000e+00
   30  00:00:01   9.4431e+02     24          6.6772e+02   2.9619e-03   2.5465e+00   1.0000e+00
   40  00:00:01   9.4931e+02     25          6.7126e+02   3.2541e-03   2.4761e+00   1.0000e+00
   50  00:00:02   9.5430e+02     26          6.7479e+02   3.5340e-03   2.4042e+00   1.0000e+00
   60  00:00:02   9.5930e+02     27          6.7833e+02   3.8020e-03   2.3300e+00   1.0000e+00
   70  00:00:02   9.6430e+02     28          6.8186e+02   4.0589e-03   2.2524e+00   1.0000e+00
   80  00:00:02   9.6930e+02     29          6.8539e+02   4.3054e-03   2.1694e+00   1.0000e+00
   90  00:00:02   9.7430e+02     30          6.8893e+02   4.5419e-03   2.0782e+00   1.0000e+00
  100  00:00:02   9.7929e+02     31          6.9246e+02   4.7681e-03   1.9730e+00   1.0000e+00
  110  00:00:02   9.8429e+02     32          6.9600e+02   4.9818e-03   1.8391e+00   1.0000e+00
  120  00:00:02   9.8902e+02     33          6.9934e+02   5.1536e-03   1.5897e+00   1.0000e+00
  126  00:00:02   9.8923e+02     34  SN      6.9949e+02   5.1496e-03   1.5259e+00   1.0000e+00
  126  00:00:02   9.8923e+02     35  FP      6.9949e+02   5.1496e-03   1.5259e+00   1.0000e+00
  130  00:00:02   9.8920e+02     36          6.9947e+02   5.1432e-03   1.5024e+00   1.0000e+00
  140  00:00:03   9.8771e+02     37          6.9842e+02   5.0383e-03   1.3508e+00   1.0000e+00
  150  00:00:03   9.8272e+02     38          6.9489e+02   4.7440e-03   1.1562e+00   1.0000e+00
  160  00:00:03   9.7772e+02     39          6.9135e+02   4.4471e-03   1.0251e+00   1.0000e+00
  170  00:00:03   9.7272e+02     40          6.8782e+02   4.1350e-03   9.1378e-01   1.0000e+00
  180  00:00:03   9.6773e+02     41          6.8428e+02   3.7993e-03   8.1081e-01   1.0000e+00
  190  00:00:03   9.6273e+02     42          6.8075e+02   3.4280e-03   7.0961e-01   1.0000e+00
  200  00:00:03   9.5773e+02     43          6.7722e+02   2.9962e-03   6.0314e-01   1.0000e+00
  210  00:00:03   9.5273e+02     44          6.7368e+02   2.4226e-03   4.7418e-01   1.0000e+00
  219  00:00:04   9.5016e+02     45  MX      6.7186e+02   1.7465e-03   3.3403e-01   1.0000e+00
```

![figure_9.png
](README_images/figure_9.png
)

```text:Output
Total time spent on FRC computation upto O(7) = 00:00:05
*****************************************
Calculating FRC using SSM with master subspace: [1  2]
(near) outer resonance detected for the following combination of master eigenvalues
     2     0
     3     0
     3     1
     4     1
     4     2
     5     2
     5     3
     6     3
     6     4
     0     2
     0     3
     1     3
     1     4
     2     4
     2     5
     3     5
     3     6
     4     6
     5     0
     6     0
     6     1
     7     1
     7     2
     8     2
     0     5
     0     6
     1     6
     1     7
     2     7
     2     8
     8     0
     9     0
     9     1
     0     8
     0     9
     1     9

These are in resonance with the follwing eigenvalues of the slave subspace
   1.0e+03 *

  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.2472 + 5.8777i
  -0.2472 + 5.8777i
  -0.2472 + 5.8777i
  -0.2472 - 5.8777i
  -0.2472 - 5.8777i
  -0.2472 - 5.8777i

sigma_out = 179
(near) inner resonance detected for the following combination of master eigenvalues
     2     1
     3     2
     4     3
     5     4
     1     2
     2     3
     3     4
     4     5

These are in resonance with the follwing eigenvalues of the master subspace
   1.0e+02 *

  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i

sigma_in = 179
Due to (near) outer resonance, the exisitence of the manifold is questionable and the underlying computation may suffer.
Attempting manifold computation
Manifold computation time at order 2 = 00:00:00
Estimated memory usage at order  2 = 7.52E-02 MB
Manifold computation time at order 3 = 00:00:00
Estimated memory usage at order  3 = 1.01E-01 MB
Manifold computation time at order 4 = 00:00:00
Estimated memory usage at order  4 = 1.29E-01 MB
Manifold computation time at order 5 = 00:00:00
Estimated memory usage at order  5 = 1.76E-01 MB
Manifold computation time at order 6 = 00:00:00
Estimated memory usage at order  6 = 2.29E-01 MB
Manifold computation time at order 7 = 00:00:00
Estimated memory usage at order  7 = 3.08E-01 MB

 Run='freqSubint1.ep': Continue equilibria along primary branch.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          7.97e-01  9.30e+02    0.0    0.0    0.0
   1   1  1.00e+00  1.12e-01  4.69e-02  9.30e+02    0.0    0.0    0.0
   2   1  1.00e+00  8.77e-04  1.98e-06  9.30e+02    0.0    0.0    0.0
   3   1  1.00e+00  6.72e-08  2.13e-14  9.30e+02    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE            om         rho1          th1          eps
    0  00:00:00   9.3016e+02      1  EP      6.5772e+02   2.7233e-03   2.8954e+00   1.0000e+00
   10  00:00:00   9.2601e+02      2          6.5478e+02   2.5108e-03   2.9154e+00   1.0000e+00
   20  00:00:00   9.2101e+02      3          6.5125e+02   2.2612e-03   2.9385e+00   1.0000e+00
   30  00:00:00   9.1601e+02      4          6.4771e+02   2.0239e-03   2.9604e+00   1.0000e+00
   40  00:00:00   9.1101e+02      5          6.4417e+02   1.8046e-03   2.9804e+00   1.0000e+00
   50  00:00:00   9.0601e+02      6          6.4064e+02   1.6074e-03   2.9983e+00   1.0000e+00
   60  00:00:00   9.0101e+02      7          6.3710e+02   1.4343e-03   3.0139e+00   1.0000e+00
   70  00:00:00   8.9601e+02      8          6.3357e+02   1.2851e-03   3.0273e+00   1.0000e+00
   80  00:00:00   8.9101e+02      9          6.3003e+02   1.1578e-03   3.0387e+00   1.0000e+00
   90  00:00:00   8.8601e+02     10          6.2650e+02   1.0495e-03   3.0484e+00   1.0000e+00
  100  00:00:00   8.8101e+02     11          6.2296e+02   9.5720e-04   3.0566e+00   1.0000e+00
  110  00:00:00   8.7601e+02     12          6.1943e+02   8.7829e-04   3.0637e+00   1.0000e+00
  120  00:00:00   8.7101e+02     13          6.1589e+02   8.1039e-04   3.0697e+00   1.0000e+00
  130  00:00:00   8.6601e+02     14          6.1236e+02   7.5159e-04   3.0749e+00   1.0000e+00
  140  00:00:01   8.6101e+02     15          6.0882e+02   7.0031e-04   3.0795e+00   1.0000e+00
  150  00:00:01   8.5601e+02     16          6.0528e+02   6.5528e-04   3.0835e+00   1.0000e+00
  160  00:00:01   8.5101e+02     17          6.0175e+02   6.1550e-04   3.0870e+00   1.0000e+00
  170  00:00:01   8.4601e+02     18          5.9821e+02   5.8012e-04   3.0902e+00   1.0000e+00
  180  00:00:01   8.4101e+02     19          5.9468e+02   5.4849e-04   3.0930e+00   1.0000e+00
  188  00:00:01   8.3715e+02     20  EP      5.9194e+02   5.2625e-04   3.0950e+00   1.0000e+00

 STEP      TIME        ||U||  LABEL  TYPE            om         rho1          th1          eps
    0  00:00:01   9.3016e+02     21  EP      6.5772e+02   2.7233e-03   2.8954e+00   1.0000e+00
   10  00:00:01   9.3431e+02     22          6.6065e+02   2.9377e-03   2.8751e+00   1.0000e+00
   20  00:00:01   9.3931e+02     23          6.6419e+02   3.1955e-03   2.8504e+00   1.0000e+00
   30  00:00:01   9.4431e+02     24          6.6772e+02   3.4506e-03   2.8256e+00   1.0000e+00
   40  00:00:01   9.4931e+02     25          6.7126e+02   3.7013e-03   2.8009e+00   1.0000e+00
   50  00:00:01   9.5431e+02     26          6.7479e+02   3.9470e-03   2.7763e+00   1.0000e+00
   60  00:00:01   9.5931e+02     27          6.7833e+02   4.1872e-03   2.7517e+00   1.0000e+00
   70  00:00:01   9.6431e+02     28          6.8186e+02   4.4220e-03   2.7274e+00   1.0000e+00
   80  00:00:02   9.6931e+02     29          6.8540e+02   4.6513e-03   2.7031e+00   1.0000e+00
   90  00:00:02   9.7431e+02     30          6.8894e+02   4.8754e-03   2.6789e+00   1.0000e+00
  100  00:00:02   9.7931e+02     31          6.9247e+02   5.0944e-03   2.6548e+00   1.0000e+00
  110  00:00:02   9.8431e+02     32          6.9601e+02   5.3086e-03   2.6307e+00   1.0000e+00
  120  00:00:02   9.8931e+02     33          6.9954e+02   5.5180e-03   2.6067e+00   1.0000e+00
  130  00:00:02   9.9431e+02     34          7.0308e+02   5.7230e-03   2.5826e+00   1.0000e+00
  140  00:00:02   9.9931e+02     35          7.0661e+02   5.9236e-03   2.5585e+00   1.0000e+00
  150  00:00:02   1.0043e+03     36          7.1015e+02   6.1200e-03   2.5343e+00   1.0000e+00
  160  00:00:02   1.0093e+03     37          7.1368e+02   6.3123e-03   2.5100e+00   1.0000e+00
  170  00:00:02   1.0143e+03     38          7.1722e+02   6.5004e-03   2.4857e+00   1.0000e+00
  180  00:00:02   1.0193e+03     39          7.2075e+02   6.6846e-03   2.4612e+00   1.0000e+00
  190  00:00:02   1.0243e+03     40          7.2429e+02   6.8648e-03   2.4366e+00   1.0000e+00
  200  00:00:02   1.0293e+03     41          7.2783e+02   7.0411e-03   2.4118e+00   1.0000e+00
  210  00:00:02   1.0343e+03     42          7.3136e+02   7.2134e-03   2.3869e+00   1.0000e+00
  220  00:00:03   1.0393e+03     43          7.3490e+02   7.3819e-03   2.3617e+00   1.0000e+00
  230  00:00:03   1.0443e+03     44          7.3843e+02   7.5465e-03   2.3364e+00   1.0000e+00
  240  00:00:03   1.0493e+03     45          7.4197e+02   7.7072e-03   2.3108e+00   1.0000e+00
  250  00:00:03   1.0543e+03     46          7.4550e+02   7.8641e-03   2.2850e+00   1.0000e+00
  260  00:00:03   1.0593e+03     47          7.4904e+02   8.0172e-03   2.2589e+00   1.0000e+00
  270  00:00:03   1.0643e+03     48          7.5257e+02   8.1664e-03   2.2325e+00   1.0000e+00
  280  00:00:03   1.0693e+03     49          7.5611e+02   8.3119e-03   2.2057e+00   1.0000e+00
  290  00:00:03   1.0743e+03     50          7.5964e+02   8.4536e-03   2.1785e+00   1.0000e+00
  300  00:00:03   1.0793e+03     51          7.6318e+02   8.5917e-03   2.1508e+00   1.0000e+00
  310  00:00:03   1.0843e+03     52          7.6671e+02   8.7261e-03   2.1226e+00   1.0000e+00
  320  00:00:03   1.0893e+03     53          7.7025e+02   8.8569e-03   2.0937e+00   1.0000e+00
  330  00:00:03   1.0943e+03     54          7.7379e+02   8.9841e-03   2.0640e+00   1.0000e+00
  340  00:00:04   1.0993e+03     55          7.7732e+02   9.1079e-03   2.0333e+00   1.0000e+00
  350  00:00:04   1.1043e+03     56          7.8086e+02   9.2283e-03   2.0015e+00   1.0000e+00
  360  00:00:04   1.1093e+03     57          7.8439e+02   9.3454e-03   1.9682e+00   1.0000e+00
  370  00:00:04   1.1143e+03     58          7.8793e+02   9.4591e-03   1.9330e+00   1.0000e+00
  380  00:00:04   1.1193e+03     59          7.9146e+02   9.5696e-03   1.8953e+00   1.0000e+00
  390  00:00:04   1.1243e+03     60          7.9500e+02   9.6768e-03   1.8540e+00   1.0000e+00
  400  00:00:04   1.1293e+03     61          7.9853e+02   9.7806e-03   1.8074e+00   1.0000e+00
  410  00:00:04   1.1343e+03     62          8.0207e+02   9.8809e-03   1.7515e+00   1.0000e+00
  420  00:00:04   1.1393e+03     63          8.0560e+02   9.9764e-03   1.6733e+00   1.0000e+00
  429  00:00:05   1.1421e+03     64  FP      8.0757e+02   1.0021e-02   1.5591e+00   1.0000e+00
  430  00:00:05   1.1421e+03     65          8.0755e+02   1.0020e-02   1.5528e+00   1.0000e+00
  440  00:00:05   1.1404e+03     66          8.0641e+02   9.9795e-03   1.4719e+00   1.0000e+00
  450  00:00:05   1.1354e+03     67          8.0288e+02   9.8663e-03   1.3809e+00   1.0000e+00
  460  00:00:05   1.1304e+03     68          7.9935e+02   9.7528e-03   1.3209e+00   1.0000e+00
  470  00:00:05   1.1254e+03     69          7.9581e+02   9.6371e-03   1.2716e+00   1.0000e+00
  480  00:00:05   1.1204e+03     70          7.9227e+02   9.5184e-03   1.2283e+00   1.0000e+00
  490  00:00:05   1.1154e+03     71          7.8874e+02   9.3966e-03   1.1888e+00   1.0000e+00
  500  00:00:06   1.1104e+03     72          7.8520e+02   9.2713e-03   1.1520e+00   1.0000e+00
  510  00:00:06   1.1054e+03     73          7.8167e+02   9.1424e-03   1.1171e+00   1.0000e+00
  520  00:00:06   1.1004e+03     74          7.7813e+02   9.0097e-03   1.0838e+00   1.0000e+00
  530  00:00:06   1.0954e+03     75          7.7460e+02   8.8731e-03   1.0516e+00   1.0000e+00
  540  00:00:06   1.0904e+03     76          7.7106e+02   8.7323e-03   1.0203e+00   1.0000e+00
  550  00:00:06   1.0854e+03     77          7.6753e+02   8.5873e-03   9.8986e-01   1.0000e+00
  560  00:00:06   1.0804e+03     78          7.6399e+02   8.4379e-03   9.6000e-01   1.0000e+00
  570  00:00:06   1.0754e+03     79          7.6046e+02   8.2840e-03   9.3065e-01   1.0000e+00
  580  00:00:06   1.0704e+03     80          7.5692e+02   8.1254e-03   9.0173e-01   1.0000e+00
  590  00:00:06   1.0654e+03     81          7.5339e+02   7.9620e-03   8.7316e-01   1.0000e+00
  600  00:00:07   1.0604e+03     82          7.4985e+02   7.7937e-03   8.4487e-01   1.0000e+00
  610  00:00:07   1.0554e+03     83          7.4631e+02   7.6203e-03   8.1682e-01   1.0000e+00
  620  00:00:07   1.0504e+03     84          7.4278e+02   7.4417e-03   7.8897e-01   1.0000e+00
  630  00:00:07   1.0455e+03     85          7.3924e+02   7.2577e-03   7.6125e-01   1.0000e+00
  640  00:00:07   1.0405e+03     86          7.3571e+02   7.0681e-03   7.3365e-01   1.0000e+00
  650  00:00:07   1.0355e+03     87          7.3217e+02   6.8726e-03   7.0610e-01   1.0000e+00
  660  00:00:07   1.0305e+03     88          7.2864e+02   6.6711e-03   6.7858e-01   1.0000e+00
  670  00:00:07   1.0255e+03     89          7.2510e+02   6.4631e-03   6.5103e-01   1.0000e+00
  680  00:00:07   1.0205e+03     90          7.2157e+02   6.2482e-03   6.2340e-01   1.0000e+00
  690  00:00:07   1.0155e+03     91          7.1803e+02   6.0258e-03   5.9561e-01   1.0000e+00
  700  00:00:07   1.0105e+03     92          7.1450e+02   5.7952e-03   5.6760e-01   1.0000e+00
  710  00:00:08   1.0055e+03     93          7.1096e+02   5.5553e-03   5.3925e-01   1.0000e+00
  720  00:00:08   1.0005e+03     94          7.0743e+02   5.3048e-03   5.1042e-01   1.0000e+00
  730  00:00:08   9.9545e+02     95          7.0389e+02   5.0419e-03   4.8095e-01   1.0000e+00
  740  00:00:08   9.9045e+02     96          7.0035e+02   4.7637e-03   4.5056e-01   1.0000e+00
  750  00:00:08   9.8545e+02     97          6.9682e+02   4.4663e-03   4.1888e-01   1.0000e+00
  760  00:00:08   9.8045e+02     98          6.9328e+02   4.1429e-03   3.8529e-01   1.0000e+00
  770  00:00:08   9.7545e+02     99          6.8975e+02   3.7811e-03   3.4865e-01   1.0000e+00
  780  00:00:08   9.7045e+02    100          6.8621e+02   3.3531e-03   3.0643e-01   1.0000e+00
  790  00:00:08   9.6545e+02    101          6.8268e+02   2.7482e-03   2.4850e-01   1.0000e+00
  797  00:00:09   9.6374e+02    102  MX      6.8147e+02   2.2298e-03   2.0015e-01   1.0000e+00
```

![figure_10.png
](README_images/figure_10.png
)

![figure_11.png
](README_images/figure_11.png
)

```text:Output
Total time spent on FRC computation upto O(7) = 00:00:12
*****************************************
Calculating FRC using SSM with master subspace: [1  2]
(near) outer resonance detected for the following combination of master eigenvalues
     2     0
     3     0
     3     1
     4     1
     4     2
     5     2
     5     3
     6     3
     6     4
     0     2
     0     3
     1     3
     1     4
     2     4
     2     5
     3     5
     3     6
     4     6
     5     0
     6     0
     6     1
     7     1
     7     2
     8     2
     0     5
     0     6
     1     6
     1     7
     2     7
     2     8
     8     0
     9     0
     9     1
     0     8
     0     9
     1     9

These are in resonance with the follwing eigenvalues of the slave subspace
   1.0e+03 *

  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.2472 + 5.8777i
  -0.2472 + 5.8777i
  -0.2472 + 5.8777i
  -0.2472 - 5.8777i
  -0.2472 - 5.8777i
  -0.2472 - 5.8777i

sigma_out = 179
(near) inner resonance detected for the following combination of master eigenvalues
     2     1
     3     2
     4     3
     5     4
     1     2
     2     3
     3     4
     4     5

These are in resonance with the follwing eigenvalues of the master subspace
   1.0e+02 *

  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i

sigma_in = 179
Due to (near) outer resonance, the exisitence of the manifold is questionable and the underlying computation may suffer.
Attempting manifold computation
Manifold computation time at order 2 = 00:00:00
Estimated memory usage at order  2 = 7.52E-02 MB
Manifold computation time at order 3 = 00:00:00
Estimated memory usage at order  3 = 1.01E-01 MB
Manifold computation time at order 4 = 00:00:00
Estimated memory usage at order  4 = 1.29E-01 MB
Manifold computation time at order 5 = 00:00:00
Estimated memory usage at order  5 = 1.76E-01 MB
Manifold computation time at order 6 = 00:00:00
Estimated memory usage at order  6 = 2.29E-01 MB
Manifold computation time at order 7 = 00:00:00
Estimated memory usage at order  7 = 3.08E-01 MB
gamma = 
   1.0e+13 *

  -0.0000 + 0.0000i
  -0.0000 - 0.0007i
   0.0062 + 4.8426i
```

![figure_12.png
](README_images/figure_12.png
)

![figure_13.png
](README_images/figure_13.png
)

```text:Output
Total time spent on FRC computation upto O(7) = 00:00:03
*****************************************
Calculating FRC using SSM with master subspace: [1  2]
(near) outer resonance detected for the following combination of master eigenvalues
     2     0
     3     0
     3     1
     4     1
     4     2
     5     2
     5     3
     6     3
     6     4
     0     2
     0     3
     1     3
     1     4
     2     4
     2     5
     3     5
     3     6
     4     6
     5     0
     6     0
     6     1
     7     1
     7     2
     8     2
     0     5
     0     6
     1     6
     1     7
     2     7
     2     8
     8     0
     9     0
     9     1
     0     8
     0     9
     1     9

These are in resonance with the follwing eigenvalues of the slave subspace
   1.0e+03 *

  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 + 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0235 - 1.8131i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 + 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.0903 - 3.5548i
  -0.2472 + 5.8777i
  -0.2472 + 5.8777i
  -0.2472 + 5.8777i
  -0.2472 - 5.8777i
  -0.2472 - 5.8777i
  -0.2472 - 5.8777i

sigma_out = 179
(near) inner resonance detected for the following combination of master eigenvalues
     2     1
     3     2
     4     3
     5     4
     1     2
     2     3
     3     4
     4     5

These are in resonance with the follwing eigenvalues of the master subspace
   1.0e+02 *

  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 + 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i
  -0.0309 - 6.5772i

sigma_in = 179
Due to (near) outer resonance, the exisitence of the manifold is questionable and the underlying computation may suffer.
Attempting manifold computation
Manifold computation time at order 2 = 00:00:00
Estimated memory usage at order  2 = 7.52E-02 MB
Manifold computation time at order 3 = 00:00:00
Estimated memory usage at order  3 = 1.01E-01 MB
Manifold computation time at order 4 = 00:00:00
Estimated memory usage at order  4 = 1.29E-01 MB
Manifold computation time at order 5 = 00:00:00
Estimated memory usage at order  5 = 1.76E-01 MB
Manifold computation time at order 6 = 00:00:00
Estimated memory usage at order  6 = 2.29E-01 MB
Manifold computation time at order 7 = 00:00:00
Estimated memory usage at order  7 = 3.08E-01 MB
gamma = 
   1.0e+13 *

  -0.0000 + 0.0000i
  -0.0000 - 0.0007i
   0.0062 + 4.8426i
```

![figure_14.png
](README_images/figure_14.png
)

![figure_15.png
](README_images/figure_15.png
)

```text:Output
Total time spent on FRC computation upto O(7) = 00:00:03
```

## Numerical integration

For the purpose of validation and calibration, we also perform a frequency sweep of the system. To save computational time and avoid reruns, `newSweep` can be set to `false`.

```matlab:Code
newSweep = false;
if newSweep
    fSweep = fFull(end)*(M\fExt);
    FRCSweep = integrateSweep(F, [650,800], n, fSweep, observable, ...
        'initRevolutions',150,'stepRevolutions', 150, 'step', 5);
    DataInfo = struct('nElements', nElements, 'fSweep', fSweep, ...
        'outdof', outdof);
    save('dataVKSweep.mat', 'DataInfo', 'FRCSweep')
else
    load('dataVKSweep.mat', 'DataInfo', 'FRCSweep')
end
```

### FRC calibration

We use our normal form dynamics to extract a forced response curve. To this end, we need to define the forcing amplitude in the normal form. We do this by passing to `calibrateFRC` a frequency and a point $y_{{\mathrm{c}\mathrm{a}\mathrm{l}}}$ in the observable space. At the defined frequency, the calibrated FRC will reach the amplitude of this point. 

The vector $y_{{\mathrm{c}\mathrm{a}\mathrm{l}}}$ lies in a delay embedded space, and can be computed either from a delay embedded time-varying response signal, or from a scalar maximal response that is artifically delay embedded. Here, `integrationBasedCalibration` allows for simulation of the forced system, where $y_{{\mathrm{c}\mathrm{a}\mathrm{l}}}$ is computed from the stable response signal. Alternatively, a scalar value $u_{{\mathrm{c}\mathrm{a}\mathrm{l}}}$ can be mapped to the observable space via a cosine function oscillating at the forcing frequency.

```matlab:Code
integrationBasedCalibration = false;
embedDim = size(yData{1,2}, 1);

if integrationBasedCalibration
    Omega = abs(imag(lambda(1)))*0.96;
    uICLinGuess = full(fFull*((-Omega^2*M+K)\fExt));
    FForced = @(t,x,w) F(t,x) + [zeros(n,1); fFull(end)*(M\fExt)*cos(w*t)];
    opts = odeset('RelTol', 1e-4); 
    [t_sim,x_sim] = ode15s(@(t,x) FForced(t,x,Omega),[0 20*2*pi/Omega], [uICLinGuess; zeros(n,1)],opts);
    customFigure(); plot(t_sim,x_sim(:,outdof),'Linewidth',1); drawnow;
    [t_sim,x_sim] = ode15s(@(t,x) FForced(t,x,Omega),t_sim(end)+[0 1*2*pi/Omega], x_sim(end,:)',opts);
    plot(t_sim,x_sim(:,outdof),'Linewidth',1); drawnow;
    uCal = max(abs(x_sim(:,outdof)));
    yCal(:,1) = uCal*cos(Omega*dt*((1:embedDim)-ceil(0.5*embedDim))).';
else
    yCal = zeros(embedDim,length(fFull)); Omega =650*ones(1,length(fFull));
    for iFRC = 1:length(fFull)
    % calibrate at FRC point
    FRC_i = FRCSSMTool.(['F' num2str(iFRC)]);
    [~,pos] =  min(abs(FRC_i.Freq-Omega(iFRC)));
    Omega(iFRC) = FRC_i.Freq(pos); 
    uCal = FRC_i.Amp(pos); 
    yCal(:,iFRC) = uCal*cos(Omega(iFRC)*dt*((1:embedDim)-ceil(0.5*embedDim))).';
    end
end

% forcing levels in the normal form space
fRed = calibrateFRC(IMInfo, RDInfo, yCal, Omega)
```

```text:Output
fRed = 3x1    
    0.2968
    0.8888
    1.8869

```

### Data-driven FRC computation

We now compute the FRC directly from the reduced dynamics model.

```matlab:Code
[IMInfoF,RDInfoF] = forcedSSMROM(IMInfo,RDInfo);
```

```text:Output
Forced SSM reduced-order model assumes external forcing only along the tangent (modal) subspace at the origin. 
```

```matlab:Code
FRCData = analyticalFRC(IMInfoF, RDInfoF, fRed, amplitudeFunction);
```

## FRC plot and evaluation

Comparison of the FRCs from SSMTool and SSMLearn with numerical integration shows that SSMLearn outperforms SSMTool at this forcing level. 

```matlab:Code
customFigure();
colors = colororder;
plot(BBCInfo.frequency/2/pi, BBCInfo.amplitude,'Color',colors(1,:),'Linewidth',2,'DisplayName', 'Backbone - SSMLearn')
plotFRC(FRCData, colors(5,:), '- SSMLearn','freqscale',2*pi)
plotFRC(FRCSSMTool, colors(3,:), '- SSMTool','freqscale',2*pi)
plot(FRCSweep.omega/2/pi,FRCSweep.amp,'.','MarkerSize',16,'Color',colors(2,:),'DisplayName','Numerical integration');
xlim(omegaSpan)
ylim([0,1.06*max(FRCSSMTool.(['F' num2str(length(fFull))]).Amp)])
xlabel('forcing frequency [Hz]')
ylabel('displacement [m]')
set(gca, 'FontSize', 18)
xlim([600 800]/2/pi)
xlim([95 130])
ylim([0 0.02])
legend('location','NW')
```

![figure_16.png
](README_images/figure_16.png
)

```matlab:Code

```

## Evaluation of the conjugacy error

We now perform crossvalidation on the normal form reduced dynamics. Specifically, we vary the polynomial order and track the training and testing performances on the conjugacy error which is used to learn the normal form.

```matlab:Code
errorInfo = conjugacyErrorTrend(etaDataTrunc,indTrain,indTest,3:2:13);
```

```text:Output
Evaluating ROM at order : 3 ... Done. 
Evaluating ROM at order : 5 ... Done. 
Evaluating ROM at order : 7 ... Done. 
Evaluating ROM at order : 9 ... Done. 
Evaluating ROM at order : 11 ... Done. 
Evaluating ROM at order : 13 ... Done. 
```

![figure_17.png
](README_images/figure_17.png
)
